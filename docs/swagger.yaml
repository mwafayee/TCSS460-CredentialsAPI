openapi: 3.0.3
info:
  title: TCSS-460 Credentials API
  version: "1.0.0"
  description: |
    REST API for authentication and user credential management. This API provides secure user registration, login, verification, and password management.

    **Authentication × Authorization = Auth²**

    Student Template/Starter Project for TCSS-460 Web API Development demonstrating authentication and authorization concepts.

    **Published Web API**
    Hosted at: [https://tcss-460-credentials-api-0b1e5408ae96.herokuapp.com](https://tcss-460-credentials-api-0b1e5408ae96.herokuapp.com)


  contact:
    name: TCSS 460 Support
    email: tcss460professor@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://tcss-460-credentials-api-0b1e5408ae96.herokuapp.com
    description: Production server
  - url: http://localhost:8000
    description: Local development


security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token from login or registration.

        Format: `Bearer <token>`

        Expiry: 14 days

  schemas:
    RegisterRequest:
      type: object
      required:
        - firstname
        - lastname
        - email
        - username
        - password
        - phone
      properties:
        firstname:
          type: string
          minLength: 1
          maxLength: 100
          description: User's first name
          example: John
        lastname:
          type: string
          minLength: 1
          maxLength: 100
          description: User's last name
          example: Doe
        email:
          type: string
          format: email
          description: Valid email address (must be unique)
          example: john.doe@example.com
        username:
          type: string
          minLength: 3
          maxLength: 50
          pattern: '^[a-zA-Z0-9_-]+$'
          description: Username (alphanumeric, underscore, hyphen only)
          example: johndoe
        password:
          type: string
          format: password
          minLength: 8
          maxLength: 128
          description: Password (8-128 characters)
          example: SecurePass123!
        phone:
          type: string
          pattern: '^\d{10,}$'
          description: Phone number (minimum 10 digits)
          example: "2065551234"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: Registered email address
          example: john.doe@example.com
        password:
          type: string
          format: password
          description: Account password
          example: SecurePass123!

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Login successful
        data:
          type: object
          properties:
            accessToken:
              type: string
              description: JWT access token
              example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
            user:
              $ref: '#/components/schemas/UserInfo'

    UserInfo:
      type: object
      properties:
        id:
          type: integer
          description: Unique user identifier
          example: 123
        email:
          type: string
          format: email
          example: john.doe@example.com
        name:
          type: string
          description: First name
          example: John
        lastname:
          type: string
          description: Last name
          example: Doe
        username:
          type: string
          example: johndoe
        role:
          type: string
          enum: [User, Moderator, Admin, SuperAdmin, Owner]
          description: User role
          example: User
        emailVerified:
          type: boolean
          description: Email verification status
          example: false
        phoneVerified:
          type: boolean
          description: Phone verification status
          example: false
        accountStatus:
          type: string
          enum: [pending, active, suspended, locked, deleted]
          description: Current account status
          example: pending

    UserDetails:
      allOf:
        - $ref: '#/components/schemas/UserInfo'
        - type: object
          properties:
            firstName:
              type: string
              example: John
            lastName:
              type: string
              example: Doe
            phone:
              type: string
              example: "2065551234"
            roleLevel:
              type: integer
              minimum: 1
              maximum: 5
              description: Role hierarchy level
              example: 1
            createdAt:
              type: string
              format: date-time
              description: Account creation timestamp
              example: '2024-01-15T10:30:00Z'
            updatedAt:
              type: string
              format: date-time
              description: Last update timestamp
              example: '2024-01-15T10:30:00Z'

    SuccessResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: Operation successful
        data:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Error message
        errorCode:
          type: string
          example: AUTH001

    ValidationErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Validation failed
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                example: email
              message:
                type: string
                example: Invalid email format

  responses:
    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            userNotFound:
              value:
                success: false
                message: User not found
                errorCode: USER001

    BadRequest:
      description: Bad request - invalid input or parameters
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ValidationErrorResponse'

    Unauthorized:
      description: Missing or invalid authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            noToken:
              value:
                success: false
                message: Auth token is not supplied
                errorCode: AUTH009
            invalidCredentials:
              value:
                success: false
                message: Invalid credentials
                errorCode: AUTH001

    Forbidden:
      description: Access forbidden - insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            invalidToken:
              value:
                success: false
                message: Token is not valid
                errorCode: AUTH007
            insufficientRole:
              value:
                success: false
                message: Admin access required
                errorCode: AUTH009
            accountSuspended:
              value:
                success: false
                message: Account is suspended. Please contact support.
                errorCode: AUTH005

    RateLimit:
      description: Rate limit exceeded
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            tooManyRequests:
              value:
                success: false
                message: Please wait before requesting again
                errorCode: VRFY006

    ServerError:
      description: Internal server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            databaseError:
              value:
                success: false
                message: Server error - contact support
                errorCode: SRVR001

paths:
  /auth/register:
    post:
      tags:
        - authentication
      summary: Register new user account
      description: |
        Creates a new user account with role 1 (User).

        **Validation Rules:**
        - Email must be unique and valid format
        - Username must be unique, 3-50 chars, alphanumeric + underscore/hyphen
        - Password must be 8-128 characters
        - Phone must be at least 10 digits

        **Account Status:** New accounts are created with 'pending' status until verified.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: Registration successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/login:
    post:
      tags:
        - authentication
      summary: Login with credentials
      description: |
        Authenticates user and returns JWT token.

        **Account Restrictions:**
        - Suspended accounts receive 403 error
        - Locked accounts receive 403 error
        - Unverified accounts can login but have limited access
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/password/reset-request:
    post:
      tags:
        - authentication
      summary: Request password reset
      description: |
        Sends password reset email if account exists and email is verified.

        **Security:** Always returns same message regardless of email existence.

        **Token Expiry:** Reset tokens expire in 1 hour.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  description: Account email address
                  example: john.doe@example.com
      responses:
        '200':
          description: Request processed (check email if account exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/password/reset:
    post:
      tags:
        - authentication
      summary: Reset password with token
      description: |
        Resets password using token from reset email.

        **Token Requirements:**
        - Must be valid JWT token
        - Must have type 'password_reset'
        - Must not be expired (1 hour limit)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: Reset token from email
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                password:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 128
                  description: New password
                  example: NewSecurePass456!
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/user/password/change:
    post:
      tags:
        - authentication
      summary: Change password (authenticated)
      description: |
        Changes user password (requires old password verification).

        **Requirements:**
        - Must provide correct old password
        - New password must be different from old
        - Updates account timestamp
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                  format: password
                  description: Current password
                  example: CurrentPass123!
                newPassword:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 128
                  description: New password (must be different)
                  example: NewSecurePass456!
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/verify/carriers:
    get:
      tags:
        - verification
      summary: Get supported SMS carriers
      description: Returns list of supported carriers for SMS verification via email gateway.
      security: []
      responses:
        '200':
          description: List of carriers
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      carriers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: att
                            name:
                              type: string
                              example: AT&T
                            gateway:
                              type: string
                              example: '@txt.att.net'
                      note:
                        type: string
                        example: Select your carrier for SMS verification

  /auth/verify/email/confirm:
    get:
      tags:
        - verification
      summary: Verify email via link
      description: |
        Verifies email address using token from verification email.

        **Token Requirements:**
        - Must match stored verification token
        - Must not be expired (48 hour limit)
        - Can only be used once
      security: []
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Verification token from email
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/verify/email/send:
    post:
      tags:
        - verification
      summary: Send email verification
      description: |
        Sends verification email with link.

        **Rate Limiting:** 1 request per 5 minutes

        **Token Expiry:** 48 hours
      responses:
        '200':
          description: Verification email sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      expiresIn:
                        type: string
                        example: 48 hours
        '400':
          $ref: '#/components/responses/BadRequest'
        '429':
          $ref: '#/components/responses/RateLimit'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/verify/phone/send:
    post:
      tags:
        - verification
      summary: Send SMS verification code
      description: |
        Sends 6-digit verification code via SMS (email-to-SMS gateway).

        **Rate Limiting:** 1 request per minute

        **Code Expiry:** 15 minutes

        **Carrier Selection:** Optional carrier parameter for specific gateways
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                carrier:
                  type: string
                  description: Optional carrier ID (att, tmobile, verizon, etc.)
                  example: att
      responses:
        '200':
          description: Verification code sent
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      expiresIn:
                        type: string
                        example: 15 minutes
                      method:
                        type: string
                        example: email-to-sms
                      availableCarriers:
                        type: array
                        items:
                          type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimit'
        '500':
          $ref: '#/components/responses/ServerError'

  /auth/verify/phone/verify:
    post:
      tags:
        - verification
      summary: Verify SMS code
      description: |
        Verifies 6-digit code sent via SMS.

        **Attempt Limit:** 3 attempts per code

        **Code Requirements:**
        - Must be 6 digits
        - Must not be expired
        - Must match most recent code
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
              properties:
                code:
                  type: string
                  pattern: '^\d{6}$'
                  description: 6-digit verification code
                  example: "123456"
      responses:
        '200':
          description: Phone verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          $ref: '#/components/responses/RateLimit'
        '500':
          $ref: '#/components/responses/ServerError'

  /jwt_test:
    get:
      tags:
        - testing
      summary: Test JWT token validity
      description: Validates JWT token and returns success message if valid.
      security: []
      responses:
        '200':
          description: Token is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Your token is valid
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /:
    get:
      tags:
        - general
      summary: Root endpoint
      description: Serves the main index.html page with API information
      security: []
      responses:
        '200':
          description: HTML page served successfully
          content:
            text/html:
              schema:
                type: string

  /doc:
    get:
      tags:
        - documentation
      summary: Documentation index
      description: |
        Displays an index of all available documentation files with links
        to both rendered HTML and raw markdown versions.
      security: []
      responses:
        '200':
          description: Documentation index page
          content:
            text/html:
              schema:
                type: string
        '500':
          $ref: '#/components/responses/ServerError'

  /doc/{filename}:
    get:
      tags:
        - documentation
      summary: Serve rendered markdown file
      description: |
        Converts markdown documentation to HTML with syntax highlighting
        and styled presentation.

        **Security:** Validates filename to prevent path traversal attacks
      security: []
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+\.md$'
          description: Markdown filename (alphanumeric, underscores, hyphens only)
          example: getting-started.md
      responses:
        '200':
          description: Rendered HTML documentation
          content:
            text/html:
              schema:
                type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /doc/raw/{filename}:
    get:
      tags:
        - documentation
      summary: Serve raw markdown file
      description: |
        Returns the raw markdown content of documentation files.
        Useful for downloading or viewing source markdown.
      security: []
      parameters:
        - name: filename
          in: path
          required: true
          schema:
            type: string
            pattern: '^[a-zA-Z0-9_-]+\.md$'
          description: Markdown filename (alphanumeric, underscores, hyphens only)
          example: getting-started.md
      responses:
        '200':
          description: Raw markdown content
          content:
            text/plain:
              schema:
                type: string
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/create:
    post:
      tags:
        - admin
      summary: Create new user (Admin)
      description: |
        Creates a new user account with specified role and details.

        **Required Role:** Admin (role level 3+)

        **Permissions:** Can set any role, email verification, and account status
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstname
                - lastname
                - email
                - username
                - password
                - phone
                - role
              properties:
                firstname:
                  type: string
                  example: Jane
                lastname:
                  type: string
                  example: Smith
                email:
                  type: string
                  format: email
                  example: jane.smith@example.com
                username:
                  type: string
                  example: janesmith
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: AdminPass123!
                phone:
                  type: string
                  example: "2065559999"
                role:
                  type: integer
                  minimum: 1
                  maximum: 5
                  description: User role level
                  example: 2
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User created successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/UserDetails'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users:
    get:
      tags:
        - admin
      summary: List all users (Admin)
      description: |
        Retrieves a paginated list of all users with filtering options.

        **Required Role:** Admin (role level 3+)
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Results per page
        - name: role
          in: query
          schema:
            type: string
          description: Filter by role name
        - name: accountStatus
          in: query
          schema:
            type: string
            enum: [pending, active, suspended, locked, deleted]
          description: Filter by account status
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserDetails'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                            example: 1
                          limit:
                            type: integer
                            example: 10
                          total:
                            type: integer
                            example: 42
                          pages:
                            type: integer
                            example: 5
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/{id}:
    get:
      tags:
        - admin
      summary: Get user by ID (Admin)
      description: |
        Retrieves detailed information about a specific user.

        **Required Role:** Admin (role level 3+)
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
          example: 123
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/UserDetails'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

    put:
      tags:
        - admin
      summary: Update user (Admin)
      description: |
        Updates user information including role, status, and verification flags.

        **Required Role:** Admin (role level 3+)

        **Note:** Cannot update passwords through this endpoint
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
          example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstname:
                  type: string
                  example: John
                lastname:
                  type: string
                  example: Updated
                email:
                  type: string
                  format: email
                  example: john.updated@example.com
                username:
                  type: string
                  example: johnupdated
                phone:
                  type: string
                  example: "2065551111"
                role:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 2
                accountStatus:
                  type: string
                  enum: [pending, active, suspended, locked, deleted]
                  example: active
                emailVerified:
                  type: boolean
                  example: true
                phoneVerified:
                  type: boolean
                  example: true
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User updated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/UserDetails'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

    delete:
      tags:
        - admin
      summary: Delete user (Admin)
      description: |
        Soft deletes a user by setting accountStatus to 'deleted'.

        **Required Role:** Admin (role level 3+)

        **Note:** This is a soft delete - user data is retained
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
          example: 123
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User deleted successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/stats/dashboard:
    get:
      tags:
        - admin
      summary: Get dashboard statistics (Admin)
      description: |
        Retrieves aggregate statistics for the admin dashboard.

        **Required Role:** Admin (role level 3+)

        **Metrics:** Total users, active users, verification rates, role distribution
      responses:
        '200':
          description: Dashboard statistics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      totalUsers:
                        type: integer
                        example: 150
                      activeUsers:
                        type: integer
                        example: 120
                      pendingUsers:
                        type: integer
                        example: 15
                      suspendedUsers:
                        type: integer
                        example: 10
                      emailVerifiedCount:
                        type: integer
                        example: 100
                      phoneVerifiedCount:
                        type: integer
                        example: 80
                      roleDistribution:
                        type: object
                        properties:
                          User:
                            type: integer
                            example: 100
                          Moderator:
                            type: integer
                            example: 30
                          Admin:
                            type: integer
                            example: 15
                          SuperAdmin:
                            type: integer
                            example: 4
                          Owner:
                            type: integer
                            example: 1
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/search:
    get:
      tags:
        - admin
      summary: Search users (Admin)
      description: |
        Search users by name, email, or username with optional filters.

        **Required Role:** Admin (role level 3+)

        **Features:** Pagination, role filter, status filter, keyword search
      parameters:
        - name: q
          in: query
          required: false
          schema:
            type: string
          description: Search term (searches firstname, lastname, email, username)
          example: john
        - name: role
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 5
          description: Filter by role (1=User, 2=Moderator, 3=Admin, 4=SuperAdmin, 5=Owner)
          example: 1
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [active, inactive, pending, suspended]
          description: Filter by account status
          example: active
        - name: page
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
          example: 1
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of results per page
          example: 20
      responses:
        '200':
          description: Search results
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 20
                      count:
                        type: integer
                        example: 15
                      searchTerm:
                        type: string
                        example: john
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/UserDetails'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/{id}/password:
    put:
      tags:
        - admin
      summary: Reset user password (Admin)
      description: |
        Allows admin to reset any user's password without requiring the old password.

        **Required Role:** Admin (role level 3+)

        **Security:** Use with caution - bypasses normal password verification
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
          example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  format: password
                  minLength: 8
                  maxLength: 128
                  description: New password for the user
                  example: NewSecurePass123!
      responses:
        '200':
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password reset successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /admin/users/{id}/role:
    put:
      tags:
        - admin
      summary: Change user role (Admin)
      description: |
        Changes a user's role. Admin can only assign roles equal to or lower than their own.

        **Required Role:** Admin (role level 3+)

        **Role Hierarchy:**
        - 1 = User
        - 2 = Moderator
        - 3 = Admin
        - 4 = SuperAdmin
        - 5 = Owner

        **Permission Rule:** Cannot assign roles higher than your own
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: User ID
          example: 123
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: integer
                  minimum: 1
                  maximum: 5
                  description: New role level (1-5)
                  example: 2
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User role updated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/UserDetails'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - Cannot assign role higher than your own
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: You cannot assign a role higher than your own
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

tags:
  - name: general
    description: General endpoints and root routes
  - name: authentication
    description: User authentication and password management
  - name: verification
    description: Email and phone verification endpoints
  - name: documentation
    description: Educational documentation endpoints
  - name: admin
    description: Administrative user management endpoints (Admin+ only)
  - name: testing
    description: Development and testing endpoints
