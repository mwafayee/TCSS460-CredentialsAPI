{
	"info": {
		"_postman_id": "tcss460-auth2-complete-tests",
		"name": "TCSS-460 Auth² API - Comprehensive Test Suite",
		"description": "Complete test collection for all API routes including open, closed, and admin endpoints. Tests authentication, authorization, validation, and role-based access control.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Open Routes (No Auth Required)",
			"item": [
				{
					"name": "Auth - Register New User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Registration successful\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    const userId = responseJson.data.user.id;",
									"    const userEmail = responseJson.data.user.email;",
									"    pm.collectionVariables.set(\"test_user_id\", userId);",
									"    pm.collectionVariables.set(\"registered_email\", userEmail);",
									"    console.log(\"User registered with ID:\", userId);",
									"    console.log(\"User registered with email:\", userEmail);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Test\",\n  \"lastname\": \"User\",\n  \"username\": \"testuser{{$timestamp}}\",\n  \"email\": \"test{{$timestamp}}@example.com\",\n  \"phone\": \"+1555{{$timestamp}}\",\n  \"password\": \"SecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["auth", "register"]
						},
						"description": "Register a new user account. Creates user with role 1 (User) by default."
					},
					"response": []
				},
				{
					"name": "Auth - Login with Valid Credentials",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login successful\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Response contains JWT token\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.data).to.have.property('accessToken');",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    const token = responseJson.data.accessToken;",
									"    pm.collectionVariables.set(\"jwt_token\", token);",
									"    console.log(\"JWT token saved\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{registered_email}}\",\n  \"password\": \"SecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["auth", "login"]
						},
						"description": "Authenticate user and receive JWT token. Uses the email from the registration step."
					},
					"response": []
				},
				{
					"name": "Auth - Login with Invalid Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Login fails with invalid password\", function () {",
									"    pm.response.to.have.status(401);",
									"    pm.expect(pm.response.json().success).to.be.false;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{registered_email}}\",\n  \"password\": \"wrongpassword\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["auth", "login"]
						},
						"description": "Test authentication failure with incorrect password."
					},
					"response": []
				},
				{
					"name": "Password Reset - Request Reset",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Password reset request processed\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{registered_email}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/password/reset-request",
							"host": ["{{base_url}}"],
							"path": ["auth", "password", "reset-request"]
						},
						"description": "Request password reset email (requires verified email)."
					},
					"response": []
				},
				{
					"name": "Password Reset - Reset with Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Test that invalid/empty token is properly rejected",
									"pm.test(\"Invalid token rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"    pm.expect(pm.response.json().success).to.be.false;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"token\": \"invalid-token-123\",\n  \"password\": \"NewSecurePass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/password/reset",
							"host": ["{{base_url}}"],
							"path": ["auth", "password", "reset"]
						},
						"description": "Test password reset with invalid token (should fail with 400)."
					},
					"response": []
				},
				{
					"name": "Verification - Get Carriers",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Carriers list retrieved\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Carriers array exists\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.data.carriers).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/verify/carriers",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "carriers"]
						},
						"description": "Get list of supported mobile carriers for SMS verification."
					},
					"response": []
				},
				{
					"name": "Verification - Confirm Email with Token (Valid)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"// Only test if we have a valid token set",
									"const hasToken = pm.collectionVariables.get('email_verification_token');",
									"",
									"if (hasToken) {",
									"    pm.test(\"Email verification successful\", function () {",
									"        pm.response.to.have.status(200);",
									"        pm.expect(pm.response.json().success).to.be.true;",
									"    });",
									"} else {",
									"    console.log('⚠️ No email_verification_token set. Set this variable from a real verification email to test valid token flow.');",
									"    pm.test(\"Skipped - no valid token available\", function () {",
									"        pm.expect(true).to.be.true;",
									"    });",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/verify/email/confirm?token={{email_verification_token}}",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "email", "confirm"],
							"query": [
								{
									"key": "token",
									"value": "{{email_verification_token}}"
								}
							]
						},
						"description": "Confirm email verification with valid token. NOTE: Set {{email_verification_token}} variable from a real verification email to test this."
					},
					"response": []
				},
				{
					"name": "Verification - Confirm Email with Invalid Token",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Invalid email token rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"    pm.expect(pm.response.json().success).to.be.false;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/verify/email/confirm?token=invalid-email-token-123",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "email", "confirm"],
							"query": [
								{
									"key": "token",
									"value": "invalid-email-token-123"
								}
							]
						},
						"description": "Test email verification with invalid token (should fail with 400)."
					},
					"response": []
				},
				{
					"name": "Test - JWT Test Endpoint",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"JWT test endpoint accessible\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/jwt_test",
							"host": ["{{base_url}}"],
							"path": ["jwt_test"]
						},
						"description": "Simple health check endpoint."
					},
					"response": []
				}
			]
		},
		{
			"name": "Closed Routes (Auth Required)",
			"item": [
				{
					"name": "Password - Change Password (Authenticated)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Password change successful\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"oldPassword\": \"SecurePass123!\",\n  \"newPassword\": \"NewSecurePass456!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/user/password/change",
							"host": ["{{base_url}}"],
							"path": ["auth", "user", "password", "change"]
						},
						"description": "Change password for authenticated user (requires old password)."
					},
					"response": []
				},
				{
					"name": "Password - Change Without Auth (Should Fail)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Unauthorized request blocked\", function () {",
									"    pm.response.to.have.status(401);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"oldPassword\": \"test\",\n  \"newPassword\": \"test123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/user/password/change",
							"host": ["{{base_url}}"],
							"path": ["auth", "user", "password", "change"]
						},
						"description": "Test that password change requires authentication."
					},
					"response": []
				},
				{
					"name": "Verification - Send Email Verification",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Email verification sent\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"// In development mode, the API returns the verification URL with token",
									"if (pm.response.code === 200) {",
									"    const responseData = pm.response.json().data;",
									"    if (responseData.verificationUrl) {",
									"        const url = new URL(responseData.verificationUrl);",
									"        const token = url.searchParams.get('token');",
									"        pm.collectionVariables.set('email_verification_token', token);",
									"        console.log('Email verification token:', token);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/verify/email/send",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "email", "send"]
						},
						"description": "Send email verification to authenticated user."
					},
					"response": []
				},
				{
					"name": "Verification - Send SMS Code (Authenticated)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"SMS code sent\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"// In development mode, the API returns the verification code",
									"if (pm.response.code === 200) {",
									"    const responseData = pm.response.json().data;",
									"    if (responseData.verificationCode) {",
									"        pm.collectionVariables.set('sms_code', responseData.verificationCode);",
									"        console.log('SMS verification code:', responseData.verificationCode);",
									"    }",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"phone\": \"+15551234567\",\n  \"carrier\": \"verizon\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/verify/phone/send",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "phone", "send"]
						},
						"description": "Send SMS verification code (authenticated route)."
					},
					"response": []
				},
				{
					"name": "Verification - Verify SMS Code (Authenticated)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"SMS code verified\", function () {",
									"    pm.response.to.have.status(200);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"code\": \"{{sms_code}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/verify/phone/verify",
							"host": ["{{base_url}}"],
							"path": ["auth", "verify", "phone", "verify"]
						},
						"description": "Verify SMS code (authenticated route)."
					},
					"response": []
				}
			]
		},
		{
			"name": "Admin Routes (Admin Auth Required)",
			"description": "Admin routes require authentication with an admin user (role 3+). These endpoints allow admins to manage users, view statistics, and perform administrative operations.",
			"item": [
				{
					"name": "Setup - Seed Admin User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Admin user seeded successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    const token = responseJson.data.accessToken;",
									"    const userId = responseJson.data.user.id;",
									"    ",
									"    // Save admin token for all other admin tests",
									"    pm.collectionVariables.set(\"admin_token\", token);",
									"    pm.collectionVariables.set(\"admin_user_id\", userId);",
									"    ",
									"    console.log(\"Admin user created with ID:\", userId);",
									"    console.log(\"Admin token saved for subsequent tests\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Admin\",\n  \"lastname\": \"User\",\n  \"username\": \"adminuser\",\n  \"email\": \"admin@test-postman.com\",\n  \"phone\": \"+15559999999\",\n  \"password\": \"Admin123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/seed-admin",
							"host": ["{{base_url}}"],
							"path": ["auth", "seed-admin"]
						},
						"description": "Creates the first admin user for testing. Only works if no admin exists yet. Automatically saves admin token for all subsequent admin tests."
					},
					"response": []
				},
				{
					"name": "Admin Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Admin login successful\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const responseJson = pm.response.json();",
									"    const token = responseJson.data.accessToken;",
									"    pm.collectionVariables.set(\"admin_token\", token);",
									"    console.log(\"Admin JWT token saved\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"{{admin_email}}\",\n  \"password\": \"{{admin_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["auth", "login"]
						},
						"description": "Login as admin user to get admin JWT token."
					},
					"response": []
				},
				{
					"name": "Users - Create New User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User created successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"if (pm.response.code === 200) {",
									"    const userId = pm.response.json().data.user.account_id;",
									"    pm.collectionVariables.set('created_user_id', userId);",
									"    console.log('Created user ID:', userId);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Admin\",\n  \"lastname\": \"Created\",\n  \"username\": \"admincreated{{$timestamp}}\",\n  \"email\": \"admincreated{{$timestamp}}@example.com\",\n  \"phone\": \"+1555{{$timestamp}}\",\n  \"password\": \"AdminPass123!\",\n  \"role\": 2\n}"
						},
						"url": {
							"raw": "{{base_url}}/admin/users/create",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "create"]
						},
						"description": "Admin creates a new user with specified role."
					},
					"response": []
				},
				{
					"name": "Users - Create User Without Admin (Should Fail)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Non-admin user blocked from creating users\", function () {",
									"    pm.response.to.have.status(403);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{jwt_token}}",
									"type": "string"
								}
							]
						},
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Test\",\n  \"lastname\": \"User\",\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"password\": \"Test123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/admin/users/create",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "create"]
						},
						"description": "Test that regular users cannot access admin routes."
					},
					"response": []
				},
				{
					"name": "Users - List All Users",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Users list retrieved\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Response contains users array\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.data.users).to.be.an('array');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users?page=1&limit=20",
							"host": ["{{base_url}}"],
							"path": ["admin", "users"],
							"query": [
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "20"
								},
								{
									"key": "status",
									"value": "active",
									"disabled": true
								},
								{
									"key": "role",
									"value": "1",
									"disabled": true
								}
							]
						},
						"description": "Get paginated list of all users with optional filters."
					},
					"response": []
				},
				{
					"name": "Users - Get Dashboard Stats",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Dashboard stats retrieved\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Stats contain required fields\", function () {",
									"    const stats = pm.response.json().data.stats;",
									"    pm.expect(stats).to.have.property('totalUsers');",
									"    pm.expect(stats).to.have.property('activeUsers');",
									"    pm.expect(stats).to.have.property('verifiedEmails');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users/stats/dashboard",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "stats", "dashboard"]
						},
						"description": "Get dashboard statistics (total users, active users, verification stats, etc.)."
					},
					"response": []
				},
				{
					"name": "Users - Get Single User by ID",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User retrieved successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"User data contains expected fields\", function () {",
									"    const user = pm.response.json().data.user;",
									"    pm.expect(user).to.have.property('id');",
									"    pm.expect(user).to.have.property('email');",
									"    pm.expect(user).to.have.property('role');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users/{{created_user_id}}",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "{{created_user_id}}"]
						},
						"description": "Get detailed information about a specific user by ID."
					},
					"response": []
				},
				{
					"name": "Users - Get Non-Existent User (Should Fail)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Non-existent user returns 404\", function () {",
									"    pm.response.to.have.status(404);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users/999999",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "999999"]
						},
						"description": "Test error handling for non-existent user ID."
					},
					"response": []
				},
				{
					"name": "Users - Update User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User updated successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Updated user data returned\", function () {",
									"    const user = pm.response.json().data.user;",
									"    pm.expect(user.firstName).to.equal('Updated');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Updated\",\n  \"lastname\": \"Name\",\n  \"email\": \"updated@example.com\",\n  \"username\": \"updateduser\",\n  \"phone\": \"2065559876\",\n  \"role\": 2\n}"
						},
						"url": {
							"raw": "{{base_url}}/admin/users/{{created_user_id}}",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "{{created_user_id}}"]
						},
						"description": "Update user information including role."
					},
					"response": []
				},
				{
					"name": "Users - Delete User (Soft Delete)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User deleted successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users/{{created_user_id}}",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "{{created_user_id}}"]
						},
						"description": "Soft delete user (sets status to 'deleted')."
					},
					"response": []
				},
				{
					"name": "Users - Search Users",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Search results retrieved\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Response contains search results\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.data.users).to.be.an('array');",
									"    pm.expect(responseJson.data).to.have.property('searchTerm');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/admin/users/search?q=test&page=1&limit=10",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "search"],
							"query": [
								{
									"key": "q",
									"value": "test"
								},
								{
									"key": "page",
									"value": "1"
								},
								{
									"key": "limit",
									"value": "10"
								},
								{
									"key": "status",
									"value": "active",
									"disabled": true
								},
								{
									"key": "role",
									"value": "1",
									"disabled": true
								}
							]
						},
						"description": "Search users by name, email, or username with filters."
					},
					"response": []
				},
				{
					"name": "Users - Reset User Password (Admin)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Password reset successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Success message returned\", function () {",
									"    const responseJson = pm.response.json();",
									"    pm.expect(responseJson.data.message).to.include('reset');",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"password\": \"NewAdminResetPass123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/admin/users/{{created_user_id}}/password",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "{{created_user_id}}", "password"]
						},
						"description": "Admin resets a user's password without requiring old password."
					},
					"response": []
				},
				{
					"name": "Users - Change User Role",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"User role changed successfully\", function () {",
									"    pm.response.to.have.status(200);",
									"    pm.expect(pm.response.json().success).to.be.true;",
									"});",
									"",
									"pm.test(\"Updated role returned\", function () {",
									"    const user = pm.response.json().data.user;",
									"    pm.expect(user.account_role).to.equal(2);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "PUT",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"role\": 2\n}"
						},
						"url": {
							"raw": "{{base_url}}/admin/users/{{created_user_id}}/role",
							"host": ["{{base_url}}"],
							"path": ["admin", "users", "{{created_user_id}}", "role"]
						},
						"description": "Admin changes a user's role (Moderator in this case)."
					},
					"response": []
				}
			]
		},
		{
			"name": "Validation Tests",
			"item": [
				{
					"name": "Register - Invalid Email Format",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Invalid email rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Test\",\n  \"lastname\": \"User\",\n  \"username\": \"testuser\",\n  \"email\": \"invalid-email\",\n  \"phone\": \"+15551234567\",\n  \"password\": \"Test123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["auth", "register"]
						},
						"description": "Test validation for invalid email format."
					},
					"response": []
				},
				{
					"name": "Register - Weak Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Weak password rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Test\",\n  \"lastname\": \"User\",\n  \"username\": \"testuser\",\n  \"email\": \"test@example.com\",\n  \"phone\": \"+15551234567\",\n  \"password\": \"weak\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["auth", "register"]
						},
						"description": "Test password strength validation (password too short - only 4 characters)."
					},
					"response": []
				},
				{
					"name": "Register - Missing Required Fields",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Missing fields rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstname\": \"Test\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": ["{{base_url}}"],
							"path": ["auth", "register"]
						},
						"description": "Test validation for missing required fields."
					},
					"response": []
				},
				{
					"name": "Login - Missing Email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Missing email rejected\", function () {",
									"    pm.response.to.have.status(400);",
									"});"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"password\": \"Test123!\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": ["{{base_url}}"],
							"path": ["auth", "login"]
						},
						"description": "Test login validation for missing email."
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Set default values if not already set",
					"if (!pm.collectionVariables.get(\"base_url\")) {",
					"    pm.collectionVariables.set(\"base_url\", \"http://localhost:8000\");",
					"}",
					"if (!pm.collectionVariables.get(\"test_email\")) {",
					"    pm.collectionVariables.set(\"test_email\", \"test@example.com\");",
					"}",
					"if (!pm.collectionVariables.get(\"test_password\")) {",
					"    pm.collectionVariables.set(\"test_password\", \"Test123!\");",
					"}",
					"if (!pm.collectionVariables.get(\"admin_email\")) {",
					"    pm.collectionVariables.set(\"admin_email\", \"admin@example.com\");",
					"}",
					"if (!pm.collectionVariables.get(\"admin_password\")) {",
					"    pm.collectionVariables.set(\"admin_password\", \"Admin123!\");",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string",
			"description": "Base URL for the API"
		},
		{
			"key": "jwt_token",
			"value": "",
			"type": "string",
			"description": "JWT token for regular user (auto-set on login)"
		},
		{
			"key": "admin_token",
			"value": "",
			"type": "string",
			"description": "JWT token for admin user (auto-set on admin login)"
		},
		{
			"key": "test_user_id",
			"value": "",
			"type": "string",
			"description": "ID of registered test user (auto-set on registration)"
		},
		{
			"key": "created_user_id",
			"value": "",
			"type": "string",
			"description": "ID of user created by admin (auto-set when admin creates user)"
		},
		{
			"key": "test_email",
			"value": "test@example.com",
			"type": "string",
			"description": "Email for test user"
		},
		{
			"key": "test_password",
			"value": "Test123!",
			"type": "string",
			"description": "Password for test user"
		},
		{
			"key": "admin_email",
			"value": "admin@test-postman.com",
			"type": "string",
			"description": "Email for admin user"
		},
		{
			"key": "admin_password",
			"value": "Admin123!",
			"type": "string",
			"description": "Password for admin user"
		},
		{
			"key": "reset_token",
			"value": "",
			"type": "string",
			"description": "Password reset token (set manually from email)"
		},
		{
			"key": "email_verification_token",
			"value": "",
			"type": "string",
			"description": "Email verification token (set manually from email)"
		}
	]
}
